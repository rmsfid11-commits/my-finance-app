import{j as e}from"./vendor-motion-CrMIN7Qx.js";import{r}from"./vendor-react-CNNLD1ro.js";import{c as _,u as E,B as j,t as k,L as p,v as F,X as S}from"./index-BVIMeOt-.js";import{G as z}from"./gift-OQYTXUHX.js";import{C as L,a as O}from"./chevron-up-DZq6uuCZ.js";import"./vendor-firebase-CgghcYGk.js";const B=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],I=_("lock",B);function V(){const{badges:m,setBadges:y,transactions:d,portfolio:N,dividends:v,setToast:R}=E(),[w,C]=r.useState(null),[f,u]=r.useState(null),b=r.useRef(Object.keys(m).length),l=r.useMemo(()=>{const t={...m},s=new Date().toISOString().split("T")[0];return t.app_join||(t.app_join={earned:!0,earnedDate:s}),d.length>0&&!t.first_input&&(t.first_input={earned:!0,earnedDate:s}),N.length>0&&!t.invest_start&&(t.invest_start={earned:!0,earnedDate:s}),v.length>0&&!t.dividend_start&&(t.dividend_start={earned:!0,earnedDate:s}),d.some(n=>n.category==="강아지")&&!t.pet_lover&&(t.pet_lover={earned:!0,earnedDate:s}),d.some(n=>n.category==="식비")&&!t.food_start&&(t.food_start={earned:!0,earnedDate:s}),new Set(d.map(n=>n.date)).size>=7&&!t.record_7&&(t.record_7={earned:!0,earnedDate:s}),t},[m,d,N,v]);r.useEffect(()=>{const t=Object.keys(l).length;if(t>b.current){const s=Object.keys(l).filter(n=>!m[n]),o=j.find(n=>s.includes(n.id));o&&(u(o),k()),y(l)}b.current=t},[l]);const a=Object.values(l).filter(t=>t.earned).length,i=p.find(t=>a>=t.min&&a<=t.max)||p[0],x=p.find(t=>t.min>a),h=F.find(t=>t.count>a),D=r.useMemo(()=>{const t={};return j.forEach(s=>{t[s.category]||(t[s.category]=[]),t[s.category].push({...s,isEarned:l[s.id]?.earned||!1,earnedDate:l[s.id]?.earnedDate})}),t},[l]),g=r.useMemo(()=>j.filter(t=>l[t.id]?.earned).map(t=>({...t,earnedDate:l[t.id].earnedDate})).sort((t,s)=>(s.earnedDate||"").localeCompare(t.earnedDate||"")).slice(0,3),[l]);return e.jsxs("div",{className:"flex-1 flex flex-col animate-slide",children:[f&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 animate-fade",onClick:()=>u(null),children:[e.jsx("div",{className:"confetti-bg absolute inset-0 pointer-events-none"}),e.jsxs("div",{className:"relative glass rounded-3xl p-8 mx-6 max-w-sm text-center animate-pop",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>u(null),className:"absolute top-3 right-3 text-c-text3",children:e.jsx(S,{size:18})}),e.jsx("div",{className:"w-20 h-20 rounded-full bg-[#FF9F43]/20 flex items-center justify-center mx-auto mb-4 animate-bounce-badge",children:e.jsx("span",{className:"text-3xl",children:f.icon})}),e.jsx("div",{className:"text-lg font-bold text-c-text mb-1",children:"배지 획득!"}),e.jsx("div",{className:"text-xl font-black text-[#FF9F43] mb-2",children:f.name}),e.jsx("div",{className:"text-sm text-c-text2 mb-5",children:f.desc}),e.jsx("button",{onClick:()=>u(null),className:"btn-primary w-full",children:"확인"})]})]}),e.jsxs("div",{className:"glass flex-1 flex flex-col",children:[e.jsxs("div",{className:"px-5 pt-5 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full glass-inner flex items-center justify-center",children:e.jsx("span",{className:"text-[#FF9F43] text-2xl font-bold",children:a})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold text-c-text",children:[a," / ",j.length]}),e.jsx("div",{className:"text-sm text-c-text2 font-medium",children:"배지 획득"})]})]}),e.jsxs("div",{className:"glass-inner rounded-2xl p-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[e.jsx("span",{className:"text-c-text",children:"현재 레벨"}),e.jsx("span",{className:"font-bold text-[#FF9F43]",children:i.name})]}),e.jsx("div",{className:"h-2.5 glass-inner rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#FF9F43] rounded-full transition-all duration-500",style:{width:`${x?(a-i.min)/(x.min-i.min)*100:100}%`}})}),x&&e.jsxs("div",{className:"text-xs text-c-text2 mt-1.5",children:["다음 레벨(",x.name,")까지 ",x.min-a,"개"]})]})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-c-border mx-5"}),e.jsxs("div",{className:"px-5 py-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#7C5CFC]/10 flex items-center justify-center",children:e.jsx(z,{size:20,className:"text-purple-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-bold text-c-text",children:"다음 보상"}),e.jsxs("div",{className:"text-xs text-c-text2",children:[h.count,"개 달성 시: ",h.reward]})]}),e.jsxs("div",{className:"text-sm font-bold text-purple-400",children:[h.count-a,"개 남음"]})]})]}),g.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-c-border mx-5"}),e.jsxs("div",{className:"px-5 py-4",children:[e.jsx("h2",{className:"text-sm font-bold mb-4 text-c-text",children:"최근 획득 배지"}),e.jsx("div",{className:"flex gap-3",children:g.map(t=>e.jsxs("div",{className:"flex-1 text-center glass-inner rounded-2xl p-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full mx-auto mb-1.5 bg-[#FF9F43]/15 flex items-center justify-center text-lg",children:t.icon}),e.jsx("div",{className:"text-xs font-bold text-c-text",children:t.name}),e.jsx("div",{className:"text-[10px] text-c-text2 mt-0.5",children:t.earnedDate})]},t.id))})]})]}),e.jsx("div",{className:"border-t border-c-border mx-5"}),Object.entries(D).map(([t,s])=>{const o=s.filter(c=>c.isEarned).length,n=w===t;return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>C(n?null:t),className:"w-full flex items-center justify-between px-5 py-4 hover:bg-c-subtle transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-c-text",children:t}),e.jsxs("span",{className:"text-xs text-c-text2 font-medium",children:["(",o,"/",s.length,")"]})]}),n?e.jsx(L,{size:16,className:"text-c-text2"}):e.jsx(O,{size:16,className:"text-c-text2"})]}),n&&e.jsx("div",{className:"px-5 pb-4 grid grid-cols-3 gap-2.5",children:s.map(c=>e.jsxs("div",{className:`text-center p-4 rounded-2xl transition-all ${c.isEarned?"bg-[#FF9F43]/8 border border-[#FF9F43]/20":"glass-inner opacity-40"}`,children:[e.jsx("div",{className:"w-9 h-9 rounded-full mx-auto mb-1.5 flex items-center justify-center text-xs font-bold",style:c.isEarned?{backgroundColor:"rgba(255,159,67,0.15)",color:"#FF9F43"}:{},children:c.isEarned?e.jsx("span",{className:"text-lg",children:c.icon}):e.jsx(I,{size:18,className:"text-c-text2"})}),e.jsx("div",{className:"text-xs font-bold text-c-text",children:c.name}),e.jsx("div",{className:"text-[10px] text-c-text2 mt-0.5",children:c.desc})]},c.id))}),e.jsx("div",{className:"border-t border-c-border mx-5"})]},t)}),e.jsxs("div",{className:"px-5 py-4",children:[e.jsx("h2",{className:"text-sm font-bold mb-4 text-c-text",children:"레벨 시스템"}),e.jsx("div",{className:"space-y-2",children:p.map(t=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-2xl transition-all ${i.name===t.name?"bg-[#FF9F43]/8 border border-[#FF9F43]/20":""}`,children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-sm font-semibold flex-1 text-c-text",children:t.name}),e.jsxs("span",{className:"text-xs text-c-text2",children:[t.min,"-",t.max,"개"]}),i.name===t.name&&e.jsx("span",{className:"text-xs bg-[#FF9F43] text-white px-2.5 py-0.5 rounded-full font-semibold",children:"현재"})]},t.name))})]}),e.jsx("div",{className:"border-t border-c-border mx-5"}),e.jsxs("div",{className:"px-5 py-4",children:[e.jsx("h2",{className:"text-sm font-bold mb-4 text-c-text",children:"배지 보상"}),e.jsx("div",{className:"space-y-2",children:F.map(t=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-2xl ${a>=t.count?"bg-[#00C48C]/8":"glass-inner"}`,children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold ${a>=t.count?"bg-[#00C48C] text-white":"bg-gray-300 text-white"}`,children:a>=t.count?"✓":t.count}),e.jsx("span",{className:`text-sm flex-1 font-medium ${a>=t.count?"text-[#00C48C]":"text-c-text2"}`,children:t.reward}),e.jsxs("span",{className:"text-xs text-c-text2",children:[t.count,"개"]})]},t.count))})]})]})]})}export{V as default};
